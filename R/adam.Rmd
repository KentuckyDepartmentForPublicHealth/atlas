
```{r options}

# ubuntu
source('/home/adam/Sandbox/adam-utils/sysOpsLibsFuncs.R')

# win
source('../../adam-utils/sysOpsLibsFuncs.R')

library(survival)
```


```{r data}

# ubuntu
geneExpressionData <- readRDS('/mnt/KDPH/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Gene Expression Data/ExpData.rds')
# atlasData <- read_csv('/mnt/KDPH/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Atlas_Data.csv')

# windows

geneExpressionData <- readRDS("P:/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Gene Expression Data/ExpData.rds")
# atlasData <- read_csv('dat/Atlas_Data.csv')
# save(atlasData, file = 'dat/atlasData.RData')

load(file = 'dat/atlasData.RData')
load("~/Sandbox/Shiny/atlas/dat/geneExpressionData.RData")
atlasData2 <- atlasData %>% 
  filter(`Diagnosis class` != '#N/A')

```


```{r cross-reference and explore}

examine <- geneExpressionData %>% 
  select(AGZ_001_U133_2.CEL)

examineOther <- atlasData %>% 
  filter(Filename %in% 'AGZ_001_U133_2.CEL')

rownames(examine) %>% length() %>% unique()

n_distinct(atlasData$Filename) # matches 7375

atlasData %>% 
  group_by(
    Filename
  ) %>% 
  count()

# List of non-tumor categories from the image
non_tumor_categories <- c("Cerebellum", "Cerebellum, Fetal", "Choroid Plexus", 
                          "CNS", "Nerve Ganglia", "Peri. Nerve", "Pituitary", 
                          "Retina", "Retina, Fetal")


# Create the binary indicator variable
atlasData2$is_tumor <- ifelse(
  # atlasData2$`Final diagnosis` %in% non_tumor_categories, 
  atlasData2$`Diagnosis class` %in% 'Non-tumor',
  0, 
  1
)

# Check the frequency to ensure the counts match
freq(atlasData2$is_tumor)
```

```{r}
glimpse(geneExpressionData)
glimpse(atlasData)
```



```{r adapt-from-hn}
#atlas<-readRDS("C:/Users/henry/Downloads/ExpData.rds")
mean.frame <- data.frame(colMeans(geneExpressionData))
jde.mean<- data.frame(mean.frame[1:170,])
# jde.hist <- read.csv("C:/Users/henry/Downloads/hist.csv")
hist <- read_csv("hist.csv")
jde.data<- bind_cols(jde.mean,hist)
colnames(jde.data)[colnames(jde.data) == "mean.frame.1.170..."] <- "Mean"
boxplot(Mean ~ Histology, data = jde.data,
        main = "Boxplot by Histology", 
        xlab = "Histology", 
        ylab = "mRNA Expression (log2)")
```



```{r adapt-from-hn}
# jde.surv<- read.csv("C:/Users/henry/Downloads/jde survival.csv")
jde.survival <- read_csv("jde survival.csv")
jde.survival$Age.Groups <- jde_survival$`Age (grouped)`

jde.survival<- jde_survival[, c("Vital status","Overall survival (months)","Original histology"), drop=F]
# jde.survival$`Overall survival (months)` <- as.numeric(jde.survival$`Overall survival (months)`)
fit<- survfit(Surv(`Overall survival (months)`,`Vital status`)~strata(Age.Groups), data=jde.survival)
plot(fit, xlab="Time", ylab="Survival", main="JDE Data", col=c(1:4), lty=c(1),conf.int = F)
legend("bottomleft",title = "Age Groups", 0.7, legend=c("10-20","20-40","40-60","60-80"), lty=1, col=1:4)


```


```{r freqs}


map(atlasData[, "Diagnosis class", drop = F], ~ freq(.x))
map(atlasData[, "Diagnosis", drop = F], ~ freq(.x))
map(atlasData[, "Final diagnosis", drop = F], ~ freq(.x))
map(select(atlasData, contains('classifier')), drop = F, ~ freq(.x))
map(atlasData[, , drop = F], ~ freq(.x) %>% head())

atlasData %>% filter(as.logical(is_tumor)) %>% pull('Final diagnosis') %>% freq
atlasData %>% filter(as.logical(is_tumor)) %>% pull('Diagnosis class') %>% freq

```

