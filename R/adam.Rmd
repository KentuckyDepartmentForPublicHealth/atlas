

```{r options}

# ubuntu
source('/home/adam/Sandbox/adam-utils/sysOpsLibsFuncs.R')

# win
source('../../adam-utils/sysOpsLibsFuncs.R')

library(survival)
```


```{r data}

# ubuntu
geneExpressionData <- readRDS('/mnt/KDPH/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Gene Expression Data/ExpData.rds')
atlasData <- read_csv('/mnt/KDPH/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Atlas_Data.csv')

# windows

geneExpressionData <- readRDS("P:/PQI/Division Office/PQI Data Analytics/BrainTumorAtlas-main/Gene Expression Data/ExpData.rds")
# atlasData <- read_csv('dat/Atlas_Data.csv')
# save(atlasData, file = 'dat/atlasData.RData')
load(file = 'dat/atlasData.RData')



```


```{r cross-reference}

examine <- geneExpressionData %>% 
  select(AGZ_001_U133_2.CEL)

examineOther <- atlasData %>% 
  filter(Filename %in% 'AGZ_001_U133_2.CEL')

rownames(examine) %>% length() %>% unique()
```

```{r}
glimpse(geneExpressionData)
glimpse(atlasData)
```



```{r adapt-from-hn}
#atlas<-readRDS("C:/Users/henry/Downloads/ExpData.rds")
mean.frame <- data.frame(colMeans(geneExpressionData))
jde.mean<- data.frame(mean.frame[1:170,])
# jde.hist <- read.csv("C:/Users/henry/Downloads/hist.csv")
hist <- read_csv("hist.csv")
jde.data<- bind_cols(jde.mean,hist)
colnames(jde.data)[colnames(jde.data) == "mean.frame.1.170..."] <- "Mean"
boxplot(Mean ~ Histology, data = jde.data,
        main = "Boxplot by Histology", 
        xlab = "Histology", 
        ylab = "mRNA Expression (log2)")
```



```{r adapt-from-hn}
# jde.surv<- read.csv("C:/Users/henry/Downloads/jde survival.csv")
jde.survival <- read_csv("jde survival.csv")
jde.survival$Age.Groups <- jde_survival$`Age (grouped)`

jde.survival<- jde_survival[, c("Vital status","Overall survival (months)","Original histology"), drop=F]
# jde.survival$`Overall survival (months)` <- as.numeric(jde.survival$`Overall survival (months)`)
fit<- survfit(Surv(`Overall survival (months)`,`Vital status`)~strata(Age.Groups), data=jde.survival)
plot(fit, xlab="Time", ylab="Survival", main="JDE Data", col=c(1:4), lty=c(1),conf.int = F)
legend("bottomleft",title = "Age Groups", 0.7, legend=c("10-20","20-40","40-60","60-80"), lty=1, col=1:4)


```


```{r freqs}


map(atlasData[, "Diagnosis class", drop = F], ~ freq(.x) %>% head())

```



# grok

```{r}
library(ggplot2)
library(dplyr)

# First, let's summarize the data to get counts for each diagnosis
diagnosis_counts <- atlasData %>%
  count(`Final diagnosis`, sort = TRUE) %>%
  filter(n > 50)  # Only show labels for diagnoses with more than 50 occurrences

# Now, compute the position for labels to avoid overlap
diagnosis_positions <- atlasData %>%
  group_by(`Final diagnosis`) %>%
  summarise(
    tsne1 = median(tsne1),
    tsne2 = median(tsne2)
  ) %>%
  inner_join(diagnosis_counts, by = "Final diagnosis")

# Create the plot
ggplot(atlasData, aes(x = tsne1, y = tsne2)) +
  geom_point(aes(color = `Final diagnosis`), alpha = 0.7, size = 2) +
  geom_text(data = diagnosis_positions, 
            aes(label = `Final diagnosis`, x = tsne1, y = tsne2),
            size = 3, check_overlap = TRUE, vjust = 1, hjust = 1) +  # Adjust size and position
  theme_minimal() +
  labs(title = "t-SNE Visualization of Tumor Types with Diagnosis Labels",
       x = "t-SNE 1",
       y = "t-SNE 2",
       color = "Diagnosis") +
  theme(legend.position = "none")  # Remove legend since we're using labels

# Save the plot if you want
# ggsave("tsne_plot_with_labels.png", width = 15, height = 10, dpi = 300)
```

```{r}
library(ggplot2)
library(dplyr)
library(ggrepel)  # For better label placement

# Compute the position for labels
diagnosis_positions <- atlasData %>%
  group_by(`Final diagnosis`) %>%
  summarise(
    tsne1 = median(tsne1),
    tsne2 = median(tsne2)
  )

# Create the plot with all labels
ggplot(atlasData, aes(x = tsne1, y = tsne2)) +
  geom_point(aes(color = `Final diagnosis`), alpha = 0.7, size = 2) +
  geom_text_repel(data = diagnosis_positions, 
                  aes(label = `Final diagnosis`, x = tsne1, y = tsne2),
                  size = 3, 
                  max.overlaps = Inf,  # Show all labels
                  box.padding = 0.5, 
                  point.padding = 0.5, 
                  segment.color = 'grey50') +
  theme_minimal() +
  labs(title = "t-SNE Visualization of Tumor Types with All Diagnosis Labels",
       x = "t-SNE 1",
       y = "t-SNE 2") +
  theme(legend.position = "none")  # Remove legend since we're using labels

# Save the plot if you want
# ggsave("tsne_plot_all_labels.png", width = 15, height = 10, dpi = 300)
```

